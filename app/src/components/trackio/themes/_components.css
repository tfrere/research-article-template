/* =========================
   TRACKIO COMPONENT STYLES
   Shared component styling across themes
   ========================= */

/* =========================
   CELL COMPONENTS
   ========================= */

/* Base cell structure */
:global(.trackio .cell) {
  border: 1px solid var(--trackio-cell-border);
  border-radius: var(--trackio-border-radius);
  background: var(--trackio-cell-background);
  display: flex;
  flex-direction: column;
  position: relative;
}

/* Cell background layer - hidden by default */
:global(.trackio .cell-bg) {
  position: absolute;
  inset: 10px;
  pointer-events: none;
  z-index: 1;
  border-radius: 4px;
  display: none;
}

/* Cell corners layer - hidden by default */
:global(.trackio .cell-corners) {
  position: absolute;
  inset: 6px;
  pointer-events: none;
  z-index: 3;
  display: none;
  opacity: 0.85;
}

:global(.trackio .cell-inner) {
  position: relative;
  z-index: 2;
  padding: var(--trackio-inner-padding);
  display: flex;
  flex-direction: column;
}

:global(.trackio .cell-header) {
  padding: 8px 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

:global(.trackio .cell-title) {
  font-size: 13px;
  font-weight: var(--trackio-font-weight-bold);
  color: var(--trackio-text-primary);
  font-family: var(--trackio-font-family);
}

:global(.trackio .cell-body) {
  position: relative;
  width: 100%;
  overflow: hidden;
}

:global(.trackio .cell-body svg) {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Wide cell spans full width */
:global(.trackio__grid .cell--wide) {
  grid-column: 1 / -1;
}

/* =========================
   LEGEND COMPONENTS
   ========================= */

.legend-bottom { 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  gap: 6px; 
  font-size: 12px; 
  text-align: center; 
  width: 80%; 
  margin: 0 auto; 
  color: var(--trackio-legend-text);
  font-family: var(--trackio-font-family);
}

.legend-title { 
  font-size: 12px; 
  font-weight: var(--trackio-font-weight-bold);
  color: var(--trackio-legend-text);
}

.items { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 8px 14px; 
  justify-content: center; 
  align-items: center; 
}

.item { 
  display: inline-flex; 
  align-items: center; 
  gap: 6px; 
  white-space: nowrap; 
  cursor: pointer; 
  padding: 2px 4px; 
  transition: opacity var(--trackio-transition-normal);
  color: var(--trackio-legend-text);
}

.swatch { 
  width: 14px; 
  height: 14px; 
  border-radius: 3px; 
  border: 1px solid var(--trackio-legend-swatch-border); 
  display: inline-block; 
}

/* Ghost hover effect */
:global(.trackio.hovering .ghost) {
  opacity: 0.2;
  transition: opacity var(--trackio-transition-normal);
}

:global(.trackio.hovering) .item.ghost { 
  opacity: 0.2; 
}

/* =========================
   TOOLTIP COMPONENTS
   ========================= */

.d3-tooltip {
  position: absolute;
  top: 0;
  left: 0;
  transform: translate(-9999px, -9999px);
  pointer-events: none;
  padding: 10px 12px;
  border-radius: 12px;
  font-size: 12px;
  line-height: 1.35;
  border: 1px solid var(--trackio-tooltip-border);
  background: var(--trackio-tooltip-background);
  color: var(--trackio-text-primary);
  box-shadow: var(--trackio-tooltip-shadow);
  opacity: 0;
  transition: opacity var(--trackio-transition-fast);
  z-index: var(--z-tooltip);
  backdrop-filter: saturate(1.12) blur(8px);
}

.d3-tooltip.is-visible { 
  opacity: 1; 
}

.d3-tooltip__inner { 
  display: flex; 
  flex-direction: column; 
  gap: 6px; 
  min-width: 220px; 
}

.d3-tooltip__inner > div:first-child { 
  font-weight: var(--trackio-font-weight-extra-bold); 
  letter-spacing: 0.1px; 
  margin-bottom: 0; 
}

.d3-tooltip__inner > div:nth-child(2) { 
  font-size: 11px; 
  color: var(--trackio-text-secondary); 
  display: block; 
  margin-top: -4px; 
  margin-bottom: 2px; 
  letter-spacing: 0.1px; 
}

.d3-tooltip__inner > div.row { 
  padding-top: 6px; 
  border-top: 1px solid var(--trackio-tooltip-border); 
  display: flex; 
  align-items: center; 
  gap: 8px; 
  white-space: nowrap; 
}

.dot { 
  display: inline-block; 
  width: 12px; 
  height: 12px; 
  border-radius: 3px; 
  border: 1px solid var(--trackio-tooltip-border); 
}

.val { 
  margin-left: auto; 
  text-align: right; 
}

/* =========================
   FULLSCREEN COMPONENTS
   ========================= */

/* Fullscreen button */
.cell-fullscreen-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: 0;
  background: transparent;
  color: var(--trackio-chart-axis-text);
  opacity: 0.6;
  cursor: pointer;
  border-radius: 6px;
  transition: opacity var(--trackio-transition-normal);
}

.cell-fullscreen-btn:hover {
  opacity: 1;
}

.cell-fullscreen-btn svg {
  width: 18px;
  height: 18px;
  fill: var(--trackio-chart-axis-text);
}

/* Fullscreen modal */
:global(.trackio-fullscreen-overlay) {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-overlay);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--trackio-transition-slow);
}

:global(.trackio-fullscreen-overlay.is-open) {
  opacity: 1;
  pointer-events: auto;
}

:global(.trackio-fullscreen-modal) {
  position: relative;
  width: min(95vw, 1400px);
  height: min(95vh, 900px);
  background: var(--surface-bg);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

:global(.trackio-fullscreen-close) {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 40px;
  height: 40px;
  border: 0;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  font-size: 20px;
  transition: background-color var(--trackio-transition-normal);
}

:global(.trackio-fullscreen-close:hover) {
  background: rgba(0, 0, 0, 0.7);
}

/* Hide fullscreen button when in modal */
:global(.trackio-fullscreen-modal .cell-fullscreen-btn) {
  display: none;
}

/* Fullscreen cell styling */
:global(.trackio-fullscreen-modal .cell) {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 0;
}

:global(.trackio-fullscreen-modal .cell-inner) {
  height: 100%;
}

:global(.trackio-fullscreen-modal .cell-body) {
  flex: 1;
  height: calc(100% - 50px);
}

:global(.trackio-fullscreen-modal .cell-body svg) {
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
}

/* =========================
   CHART STYLING
   ========================= */

/* Legacy axis/grid selectors - for compatibility */
.trackio .axes path,
.trackio .axes line {
  stroke: var(--trackio-chart-axis-stroke);
}

.trackio .axes text {
  fill: var(--trackio-chart-axis-text);
  font-family: var(--trackio-font-family);
}

.trackio .grid line {
  stroke: var(--trackio-chart-grid-stroke);
  opacity: var(--trackio-chart-grid-opacity);
}

/* Minor ticks styling for logarithmic scales */
:global(.trackio .minor-ticks line.minor-tick) {
  stroke: var(--trackio-chart-axis-stroke);
  stroke-opacity: 0.4;
  stroke-width: 0.5px;
}

/* Grid type switching */
.trackio .grid-dots { 
  display: none; 
}

/* =========================
   OBLIVION THEME COMPONENT OVERRIDES
   ========================= */

/* Oblivion cell specific styling */
:global(.trackio.theme--oblivion .cell-inner) {
  padding: var(--trackio-oblivion-hud-corner-size, 8px) 12px 10px var(--trackio-oblivion-hud-gap, 10px);
}

:global(.trackio.theme--oblivion .cell-bg) {
  display: block !important;
  background: 
    radial-gradient(1200px 200px at 20% -10%, rgba(0,0,0,.05), transparent 80%),
    radial-gradient(900px 200px at 80% 110%, rgba(0,0,0,.05), transparent 80%);
}

:global([data-theme="dark"]) :global(.trackio.theme--oblivion .cell-bg) {
  background:
    radial-gradient(1400px 260px at 20% -10%, color-mix(in srgb, #ffffff 6.5%, transparent), transparent 80%),
    radial-gradient(1100px 240px at 80% 110%, color-mix(in srgb, #ffffff 6%, transparent), transparent 80%),
    linear-gradient(180deg, color-mix(in srgb, #ffffff 3.5%, transparent), transparent 45%);
}

:global(.trackio.theme--oblivion .cell-corners) {
  display: block !important;
  inset: 6px;
  background:
    linear-gradient(#000000, #000000) top left / 8px 1px no-repeat,
    linear-gradient(#000000, #000000) top left / 1px 8px no-repeat,
    linear-gradient(#000000, #000000) top right / 8px 1px no-repeat,
    linear-gradient(#000000, #000000) top right / 1px 8px no-repeat,
    linear-gradient(#000000, #000000) bottom left / 8px 1px no-repeat,
    linear-gradient(#000000, #000000) bottom left / 1px 8px no-repeat,
    linear-gradient(#000000, #000000) bottom right / 8px 1px no-repeat,
    linear-gradient(#000000, #000000) bottom right / 1px 8px no-repeat;
  opacity: 1;
  z-index: 3;
}

:global([data-theme="dark"]) :global(.trackio.theme--oblivion .cell-corners) {
  background:
    linear-gradient(#ffffff, #ffffff) top left / 8px 1px no-repeat,
    linear-gradient(#ffffff, #ffffff) top left / 1px 8px no-repeat,
    linear-gradient(#ffffff, #ffffff) top right / 8px 1px no-repeat,
    linear-gradient(#ffffff, #ffffff) top right / 1px 8px no-repeat,
    linear-gradient(#ffffff, #ffffff) bottom left / 8px 1px no-repeat,
    linear-gradient(#ffffff, #ffffff) bottom left / 1px 8px no-repeat,
    linear-gradient(#ffffff, #ffffff) bottom right / 8px 1px no-repeat,
    linear-gradient(#ffffff, #ffffff) bottom right / 1px 8px no-repeat;
}

:global(.trackio.theme--oblivion .cell-header) {
  padding: 5px 0px 18px 12px;
}

:global(.trackio.theme--oblivion .cell-title) {
  font-family: 'Roboto Mono', 'Roboto Mono Fallback', ui-monospace, SFMono-Regular, Menlo, monospace !important;
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--trackio-oblivion-primary);
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
  padding-left: 0;
}

:global(.trackio.theme--oblivion .cell-title)::before {
  content: "";
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 6px;
  height: 6px;
  background: var(--trackio-oblivion-primary);
  border: 1px solid var(--trackio-oblivion-dim);
  box-shadow: 0 0 10px color-mix(in srgb, var(--trackio-oblivion-base) 25%, transparent) inset;
  opacity: 0.5;
}

/* Force Roboto Mono in Oblivion theme for legend */
:global(.trackio.theme--oblivion) .legend-bottom,
:global(.trackio.theme--oblivion) .legend-title,
:global(.trackio.theme--oblivion) .item {
  font-family: 'Roboto Mono', 'Roboto Mono Fallback', ui-monospace, SFMono-Regular, Menlo, monospace !important;
  letter-spacing: 0.06em;
}

:global(.trackio.theme--oblivion) .legend-title {
  font-weight: 900 !important;
  letter-spacing: 0.18em !important;
  text-transform: uppercase !important;
}

/* Oblivion theme: enhanced minor ticks */
:global(.trackio.theme--oblivion .minor-ticks line.minor-tick) {
  stroke: var(--trackio-oblivion-dim);
  stroke-opacity: 0.6;
  stroke-width: 0.8px;
}

/* Force font-family for SVG text in Oblivion */
.trackio.theme--oblivion .axes text {
  font-family: 'Roboto Mono', 'Roboto Mono Fallback', ui-monospace, SFMono-Regular, Menlo, monospace !important;
}

/* =========================
   OBLIVION TOOLTIP STYLES
   ========================= */

/* Tooltip variables for Oblivion theme */
:global(.trackio.theme--oblivion) .d3-tooltip {
  /* Light mode variables */
  --tooltip-oblivion-base: #2a2a2a;
  --tooltip-oblivion-bg-primary: color-mix(in srgb, var(--tooltip-oblivion-base) 15%, transparent);
  --tooltip-oblivion-bg-secondary: color-mix(in srgb, var(--tooltip-oblivion-base) 10%, transparent);
  --tooltip-oblivion-bg-base: color-mix(in srgb, var(--tooltip-oblivion-base) 5%, transparent);
  --tooltip-oblivion-border: color-mix(in srgb, var(--tooltip-oblivion-base) 5%, transparent);
  --tooltip-oblivion-shadow: color-mix(in srgb, var(--tooltip-oblivion-base) 8%, transparent);
  --tooltip-oblivion-text: color-mix(in srgb, var(--tooltip-oblivion-base) 90%, transparent);
  --tooltip-oblivion-line-dark: rgba(0, 0, 0, 0.08);
  --tooltip-oblivion-line-light: rgba(255, 255, 255, 0.15);
}

/* Dark mode variables */
:global([data-theme="dark"]) :global(.trackio.theme--oblivion) .d3-tooltip {
  --tooltip-oblivion-base: #ffffff;
  --tooltip-oblivion-bg-primary: color-mix(in srgb, var(--tooltip-oblivion-base) 15%, transparent);
  --tooltip-oblivion-bg-secondary: color-mix(in srgb, var(--tooltip-oblivion-base) 10%, transparent);
  --tooltip-oblivion-bg-base: color-mix(in srgb, var(--tooltip-oblivion-base) 5%, transparent);
  --tooltip-oblivion-border: color-mix(in srgb, var(--tooltip-oblivion-base) 5%, transparent);
  --tooltip-oblivion-shadow: color-mix(in srgb, var(--tooltip-oblivion-base) 8%, transparent);
  --tooltip-oblivion-text: color-mix(in srgb, var(--tooltip-oblivion-base) 90%, transparent);
  --tooltip-oblivion-line-dark: rgba(0, 0, 0, 0.15);
  --tooltip-oblivion-line-light: rgba(255, 255, 255, 0.08);
}

/* Oblivion tooltip styling */
:global(.trackio.theme--oblivion) .d3-tooltip {
  border-radius: 8px;
  border: none;
  background: 
    radial-gradient(400px 100px at 30% 0%, var(--tooltip-oblivion-bg-primary), transparent 70%),
    radial-gradient(300px 80px at 70% 100%, var(--tooltip-oblivion-bg-secondary), transparent 70%),
    var(--tooltip-oblivion-bg-base);
  color: var(--tooltip-oblivion-text);
  box-shadow: 
    0 0 0 1px var(--tooltip-oblivion-border),
    0 8px 40px var(--tooltip-oblivion-shadow),
    0 2px 8px rgba(0, 0, 0, 0.05);
  backdrop-filter: saturate(1.1) blur(10px);
  opacity: 0.5;
}

:global(.trackio.theme--oblivion) .d3-tooltip.is-visible {
  opacity: 1;
}

:global(.trackio.theme--oblivion) .d3-tooltip__inner > div:first-child {
  font-weight: 900;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--tooltip-oblivion-text);
}

:global(.trackio.theme--oblivion) .d3-tooltip__inner > div:nth-child(2) {
  color: var(--tooltip-oblivion-text);
  opacity: 0.4;
  letter-spacing: 0.06em;
}

:global(.trackio.theme--oblivion) .d3-tooltip__inner > div.row {
  position: relative;
  padding-top: 10px;
  margin-top: 6px;
  border-top: none;
}

:global(.trackio.theme--oblivion) .d3-tooltip__inner > div.row::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  height: 1px;
  background: var(--tooltip-oblivion-line-dark);
}

:global(.trackio.theme--oblivion) .d3-tooltip__inner > div.row::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 1px;
  height: 1px;
  background: var(--tooltip-oblivion-line-light);
}

:global(.trackio.theme--oblivion) .dot {
  border-radius: 2px;
  border: 1px solid var(--trackio-chart-axis-stroke);
  box-shadow: 0 0 10px color-mix(in srgb, var(--trackio-oblivion-base) 20%, transparent) inset;
}
